<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰ªåˆ€çŸ³é ­å¸ƒ - å¿«æ¨‚å­¸ç¿’æ¨‚åœ’</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/rock-paper-scissors.css}">
</head>

<body class="rps-page">
    <div th:replace="~{fragments :: nav('/games/menu', 'ä¸Šä¸€é ')}"></div>

    <main class="rps-main">
        <div class="game-container" id="game-container">
            <h1 class="game-title">âœŠ å‰ªåˆ€çŸ³é ­å¸ƒ âœŒï¸</h1>

            <div class="battle-area">
                <div class="player-side">
                    <div class="player-label">ğŸ‘¤ ä½ </div>
                    <div class="choice-display waiting" id="player-choice">?</div>
                </div>
                <div class="vs-text">VS</div>
                <div class="computer-side">
                    <div class="computer-label">ğŸ¤– é›»è…¦</div>
                    <div class="choice-display waiting" id="computer-choice">?</div>
                </div>
            </div>

            <div class="choices-container" id="choices-container">
                <div class="choice-wrapper">
                    <button class="choice-btn rock" onclick="play('rock')" title="çŸ³é ­">âœŠ</button>
                    <div class="choice-label">çŸ³é ­</div>
                </div>
                <div class="choice-wrapper">
                    <button class="choice-btn scissors" onclick="play('scissors')" title="å‰ªåˆ€">âœŒï¸</button>
                    <div class="choice-label">å‰ªåˆ€</div>
                </div>
                <div class="choice-wrapper">
                    <button class="choice-btn paper" onclick="play('paper')" title="å¸ƒ">ğŸ–ï¸</button>
                    <div class="choice-label">å¸ƒ</div>
                </div>
            </div>

            <div class="result-message" id="result-message"></div>
            <button class="btn-restart hidden" id="restart-btn" onclick="resetGame()">å†ç©ä¸€æ¬¡ ğŸ”„</button>
        </div>

        <div class="celebration hidden" id="celebration"></div>
    </main>

    <!-- è¼‰å…¥èªéŸ³è¼”åŠ©ç³»çµ± -->
    <script th:src="@{/js/speech-helper.js}"></script>

    <script>
        const choices = { rock: 'âœŠ', scissors: 'âœŒï¸', paper: 'ğŸ–ï¸' };
        const choiceNames = { rock: 'çŸ³é ­', scissors: 'å‰ªåˆ€', paper: 'å¸ƒ' };

        // é é¢è¼‰å…¥æ™‚æ’­æ”¾èªªæ˜
        window.addEventListener('load', () => {
            setTimeout(() => {
                SpeechHelper.speak('é¸æ“‡çŸ³é ­ã€å‰ªåˆ€æˆ–å¸ƒï¼');
            }, 500);
        });

        function getResult(player, computer) {
            if (player === computer) return 'draw';
            if ((player === 'rock' && computer === 'scissors') ||
                (player === 'scissors' && computer === 'paper') ||
                (player === 'paper' && computer === 'rock')) {
                return 'win';
            }
            return 'lose';
        }

        function getComputerChoice() {
            const options = ['rock', 'scissors', 'paper'];
            return options[Math.floor(Math.random() * options.length)];
        }

        function play(playerChoice) {
            const computerChoice = getComputerChoice();
            const result = getResult(playerChoice, computerChoice);

            // æ’­æ”¾é»æ“ŠéŸ³æ•ˆ
            SoundHelper.play('click');

            // èªéŸ³å¿µå‡ºç©å®¶é¸æ“‡
            SpeechHelper.speak('ä½ å‡º' + choiceNames[playerChoice]);

            // ç¦ç”¨æŒ‰éˆ•
            const buttons = document.querySelectorAll('.choice-btn');
            buttons.forEach(btn => btn.disabled = true);

            // é¡¯ç¤ºç©å®¶é¸æ“‡
            const playerDisplay = document.getElementById('player-choice');
            const computerDisplay = document.getElementById('computer-choice');

            playerDisplay.textContent = choices[playerChoice];
            playerDisplay.classList.remove('waiting');
            playerDisplay.classList.add('pop-in');

            // å»¶é²é¡¯ç¤ºé›»è…¦é¸æ“‡
            setTimeout(() => {
                computerDisplay.textContent = choices[computerChoice];
                computerDisplay.classList.remove('waiting');
                computerDisplay.classList.add('pop-in');

                // èªéŸ³å¿µå‡ºé›»è…¦é¸æ“‡
                SpeechHelper.speak('é›»è…¦å‡º' + choiceNames[computerChoice], () => {
                    // é¡¯ç¤ºçµæœ
                    setTimeout(() => {
                        showResult(result, playerDisplay, computerDisplay);
                    }, 300);
                });
            }, 800);
        }

        function showResult(result, playerDisplay, computerDisplay) {
            const resultMessage = document.getElementById('result-message');
            const restartBtn = document.getElementById('restart-btn');

            playerDisplay.classList.remove('pop-in', 'winner', 'loser', 'draw');
            computerDisplay.classList.remove('pop-in', 'winner', 'loser', 'draw');
            resultMessage.classList.remove('win', 'lose', 'draw');

            if (result === 'win') {
                playerDisplay.classList.add('winner');
                computerDisplay.classList.add('loser');
                resultMessage.innerHTML = 'ğŸ‰ ä½ è´äº†ï¼å¤ªæ£’äº†ï¼ ğŸ‰';
                resultMessage.classList.add('win');

                // éŸ³æ•ˆå’ŒèªéŸ³
                SoundHelper.play('win');
                setTimeout(() => SpeechHelper.speak('å¤ªæ£’äº†ï¼ä½ è´äº†ï¼'), 300);

                createCelebration();
            } else if (result === 'lose') {
                playerDisplay.classList.add('loser');
                computerDisplay.classList.add('winner');
                resultMessage.innerHTML = 'ğŸ˜¢ é›»è…¦è´äº†ï¼å†è©¦ä¸€æ¬¡ï¼ ğŸ’ª';
                resultMessage.classList.add('lose');

                // éŸ³æ•ˆå’ŒèªéŸ³ï¼ˆæ­£å‘é¼“å‹µï¼‰
                SoundHelper.play('wrong');
                setTimeout(() => SpeechHelper.speak('æ²’é—œä¿‚ï¼å†è©¦ä¸€æ¬¡ï¼'), 300);
            } else {
                playerDisplay.classList.add('draw');
                computerDisplay.classList.add('draw');
                resultMessage.innerHTML = 'ğŸ¤ å¹³æ‰‹ï¼å†ä¾†ä¸€å±€ï¼ ğŸ¤';
                resultMessage.classList.add('draw');

                // éŸ³æ•ˆå’ŒèªéŸ³
                SoundHelper.play('pop');
                setTimeout(() => SpeechHelper.speak('å¹³æ‰‹ï¼å†ä¾†ä¸€æ¬¡ï¼'), 300);
            }

            restartBtn.classList.remove('hidden');
        }

        function createCelebration() {
            const celebration = document.getElementById('celebration');
            celebration.classList.remove('hidden');
            celebration.innerHTML = '';

            const colors = ['#FF6B6B', '#4ECDC4', '#FFE66D', '#95E1D3', '#F38181', '#AA96DA'];
            for (let i = 0; i < 30; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                celebration.appendChild(confetti);
            }

            setTimeout(() => celebration.classList.add('hidden'), 3000);
        }

        function resetGame() {
            const playerDisplay = document.getElementById('player-choice');
            const computerDisplay = document.getElementById('computer-choice');
            const resultMessage = document.getElementById('result-message');
            const restartBtn = document.getElementById('restart-btn');
            const buttons = document.querySelectorAll('.choice-btn');

            playerDisplay.textContent = '?';
            playerDisplay.className = 'choice-display waiting';
            computerDisplay.textContent = '?';
            computerDisplay.className = 'choice-display waiting';

            resultMessage.innerHTML = '';
            resultMessage.className = 'result-message';

            restartBtn.classList.add('hidden');
            buttons.forEach(btn => btn.disabled = false);

            // éŸ³æ•ˆå’ŒèªéŸ³
            SoundHelper.play('click');
            SpeechHelper.speak('å†ä¾†ä¸€æ¬¡ï¼é¸æ“‡çŸ³é ­ã€å‰ªåˆ€æˆ–å¸ƒï¼');
        }
    </script>
</body>

</html>